<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scripts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/assets/favicon.png" type="image/png">
    <link rel="stylesheet" href="./assets/common.css">
    <script src="./assets/common.js"></script>
</head>

<body class="h-screen flex items-center justify-center bg-black flex-col font-black">

    <!-- Warning Modal Section  -->
    <input class="modal-state" id="warning" type="checkbox" />
    <div class="modal">
        <div class="modal__inner">
            <h2 class="text-center">Warning</h2>
            <p class="modal__p">
                Kindly use a desktop or laptop for a better experience.
            </p>
        </div>
    </div>

    <!-- Script Detailed Modal -->
    <div id="script-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 justify-center items-center">
        <div class="bg-white text-black p-6 rounded-lg max-w-lg w-full relative">
            <button id="closeModal" class="absolute top-2 right-2 text-xl font-bold">&times;</button>
            <h2 id="modalTitle" class="text-xl font-bold mb-2"></h2>
            <ul id="modalContent" class="list-disc ml-5 text-sm"></ul>
            <div class="flex justify-end mt-4">
                <button id="showCodeBtn" class="mt-4 px-4 py-2 bg-black text-white rounded hover:bg-gray-800">

                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"
                        class="h-3 w-3 inline-block mr-1 fill-current text-white">
                        <path
                            d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3L562.7 256l-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z" />
                    </svg>
                    <span>
                        Show Code
                    </span></button>
                <button id="downloadBtn" class="mt-4 ml-2 px-4 py-2 bg-black text-white rounded hover:bg-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 inline-block mr-1 fill-current text-white"
                        viewBox="0 0 512 512">
                        <path
                            d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 242.7-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7 288 32zM64 352c-35.3 0-64 28.7-64 64l0 32c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-32c0-35.3-28.7-64-64-64l-101.5 0-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352 64 352zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z" />
                    </svg>
                    <span>
                        Download
                    </span>
                </button>
            </div>
            <!-- <button id="copyExecutionCommand"
                class="mt-4 ml-2 px-4 py-2 bg-black text-white rounded hover:bg-gray-800 disabled:opacity-50">Copy
                Execution Command</button> -->

        </div>
    </div>

    <!-- Fullscreen Code Modal -->
    <div id="code-modal" class="hidden fixed inset-0 z-50 flex flex-col">
        <div class="flex justify-end p-2 gap-3">
            <button id="copyCode"
                class="bg-gray-900 text-white px-4 py-2 rounded hover:bg-gray-800 disabled:opacity-50">
                copy code
            </button>
            <button id="closeCodeModal"
                class="bg-gray-900 text-white text-3xl font-bold px-3 rounded hover:bg-gray-800">&times;</button>
        </div>
        <div id="editor" class="w-full h-full rounded-md overflow-hidden self-center"></div>
    </div>

    <!-- Main context -->
    <img src="./assets/favicon.png" alt="icon" class="w-[100px] h-[100px] mb-1" />
    <h1 class="text-white text-[30px]">.Scripts.</h1>
    <div id="scriptsList" class="flex flex-col text-white gap-y-2 p-10"></div>

    <!-- Footer -->
    <div class="footer">
        <div class="flex items-center gap-6">
            <a href="https://github.com/The-Robin-Hood/scripts" target="_blank">
                <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/github.svg" class="h-8 w-8" alt="GitHub" />
            </a>
            <a href="https://x.com/ansariwtf" target="_blank">
                <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/x.svg" class="h-8 w-8" alt="X/Twitter" />
            </a>
        </div>
    </div>

    <script>
        const scriptsList = document.getElementById('scriptsList');
        const modal = document.getElementById('script-modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const closeModal = document.getElementById('closeModal');
        const showCodeBtn = document.getElementById('showCodeBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const copyExecutionCommand = document.getElementById('copyExecutionCommand');
        const codeModal = document.getElementById('code-modal');
        const closeCodeModal = document.getElementById('closeCodeModal');
        const copyCode = document.getElementById('copyCode');

        let currentScript = null;

        closeModal.addEventListener('click', () => modal.classList.add('hidden'));
        closeCodeModal.addEventListener('click', () => {
            codeModal.classList.add('hidden');
            if (monaco.editor.getModels().length > 0) {
                monaco.editor.getModels()[0].dispose();
            }
            const editor = document.getElementById('editor');
            if (editor.children.length > 0) {
                editor.innerHTML = '';
            }
        });

        fetch('./scripts.json')
            .then(res => res.json())
            .then(data => {
                data.forEach(script => {
                    const label = document.createElement('label');
                    label.textContent = `${script.id}. ${script.title}`;
                    label.className = 'opacity-75 hover:opacity-100 hover:text-yellow-400 cursor-pointer';
                    label.addEventListener('click', () => {
                        currentScript = script;
                        modalTitle.textContent = script.title;
                        if (!script.description) {
                            script.description = 'No description available.';
                        } else if (Array.isArray(script.description)) {
                            script.description = script.description.join('</li><li>');
                        }
                        modalContent.innerHTML = `<li>${script.description || 'No description available.'}</li>`;
                        modal.classList.remove('hidden');
                        modal.classList.add('flex');
                    });
                    scriptsList.appendChild(label);
                });
            })
            .catch(err => console.error('Error loading scripts.json:', err));

        showCodeBtn.addEventListener('click', async () => {
            if (!currentScript || !currentScript.filename) return;
            const response = await fetch(`./${currentScript.filename}`);
            const code = await response.text();
            codeModal.classList.remove('hidden');

            //delete previous editor instance if exists
            const editor = document.getElementById('editor');
            if (editor.children.length > 0) {
                editor.innerHTML = '';
            }

            require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs' } });
            require(['vs/editor/editor.main'], () => {
                monaco.editor.defineTheme("myTheme", {
                    base: "vs-dark",
                    inherit: true,
                    rules: [],
                    colors: {
                        "editor.background": "#191a21",
                    },
                });
                monaco.editor.setTheme("myTheme");

                monaco.editor.create(document.getElementById('editor'), {
                    value: code,
                    language: `${currentScript.language || 'plaintext'}`,
                    fontSize: 14,
                    minimap: { enabled: false },
                    scrollBeyondLastLine: false,
                    readOnly: true,
                    lineNumbers: false,
                });
            });
        });

        downloadBtn.addEventListener('click', () => {
            if (!currentScript || !currentScript.filename) return;
            const link = document.createElement('a');
            link.href = `./${currentScript.filename}`;
            link.download = currentScript.filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // copyExecutionCommand.addEventListener('click', () => {
        //     if (!currentScript || !currentScript.filename) return;
        //     const command = `curl -s https://scripts.ansariwtf.sh/${currentScript.filename} | bash`;
        //     navigator.clipboard.writeText(command).then(() => {
        //         copyExecutionCommand.textContent = 'Command Copied!';
        //         copyExecutionCommand.disabled = true;
        //         setTimeout(() => {
        //             copyExecutionCommand.textContent = 'Copy Execution Command';
        //             copyExecutionCommand.disabled = false;
        //         }, 2000);
        //     }).catch(err => {
        //         console.error('Failed to copy command:', err);
        //     });
        // });

        copyCode.addEventListener('click', () => {
            const editor = monaco.editor.getModels()[0];
            if (editor) {
                const code = editor.getValue();
                navigator.clipboard.writeText(code).then(() => {
                    copyCode.textContent = 'copied!';
                    copyCode.disabled = true;
                    setTimeout(() => {
                        copyCode.textContent = 'copy code';
                        copyCode.disabled = false;
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy code:', err);
                });
            }
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
</body>

</html>